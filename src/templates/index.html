<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Application</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="map-container">
        <iframe id="map" src="/map" frameborder="0" width="100%" height="100%"></iframe>
    </div>
    <div class="controls">
        <form method="POST">
            <div class="control-group">
                <label for="city_name">City Name</label>
                <input type="text" name="city_name" id="city_name" placeholder="Enter city name" 
                       value="{{ request.form.get('city_name', 'Wrocław, Polska') }}">
            </div>

            <div class="category-group">
                <div class="category-title">Shop & Ship</div>

                <div class="control-group">
                    <label for="shop_distance">Supermarket Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="shop_enabled" id="shop_enabled">
                        <input type="number" name="shop_distance" id="shop_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="mall_distance">Mall Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="mall_enabled" id="mall_enabled">
                        <input type="number" name="mall_distance" id="mall_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="post_distance">Post Office / Parcel Locker Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="post_enabled" id="post_enabled">
                        <input type="number" name="post_distance" id="post_distance">
                    </div>
                </div>
            </div>

            <div class="category-group">
                <div class="category-title">Education</div>

                <div class="control-group">
                    <label for="school_distance">School Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="school_enabled" id="school_enabled">
                        <input type="number" name="school_distance" id="school_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="kindergarten_distance">Kindergarten Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="kindergarten_enabled" id="kindergarten_enabled">
                        <input type="number" name="kindergarten_distance" id="kindergarten_distance">
                    </div>
                </div>

            </div>

            <div class="category-group">
                <div class="category-title">Health & Safety</div>

                <div class="control-group">
                    <label for="hospital_distance">Hospital Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="hospital_enabled" id="hospital_enabled">
                        <input type="number" name="hospital_distance" id="hospital_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="police_distance">Police Station Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="police_enabled" id="police_enabled">
                        <input type="number" name="police_distance" id="police_distance">
                    </div>
                </div>

            </div>

            <div class="category-group">
                <div class="category-title">Transport</div>

                <div class="control-group">
                    <label for="station_distance">Bus / Tram Stop Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="station_enabled" id="station_enabled">
                        <input type="number" name="station_distance" id="station_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="railway_station_distance">Railway Station Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="railway_station_enabled" id="railway_station_enabled">
                        <input type="number" name="railway_station_distance" id="railway_station_distance">
                    </div>
                </div>

            </div>

            <div class="category-group">
                <div class="category-title">Lifestyle & Recreation</div>

                <div class="control-group">
                    <label for="park_distance">Park Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="park_enabled" id="park_enabled">
                        <input type="number" name="park_distance" id="park_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="sport_distance">Sports Facility Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="sport_enabled" id="sport_enabled">
                        <input type="number" name="sport_distance" id="sport_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="restaurant_distance">Restaurant Distance (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="restaurant_enabled" id="restaurant_enabled">
                        <input type="number" name="restaurant_distance" id="restaurant_distance">
                    </div>
                </div>

                <div class="control-group">
                    <label for="entertainment_distance">Cinema / Theatre (m)</label>
                    <div class="toggle">
                        <input type="checkbox" name="entertainment_enabled" id="entertainment_enabled">
                        <input type="number" name="entertainment_distance" id="entertainment_distance">
                    </div>
                </div>
            </div>

            <button>Search</button>
        </form>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Opóźnienie w celu załadowania iframe
            setTimeout(() => {
                const mapContainer = document.getElementById('map');
                if (mapContainer) {
                    mapContainer.style.display = 'block';
                    mapContainer.style.width = '100%';
                    mapContainer.style.height = '100vh';

                    if (window.kepler) {
                        console.log("handleResize");
                        window.kepler.handleResize();
                    }
                } else {
                    console.error("Element o id 'map' nie został znaleziony.");
                }

                window.dispatchEvent(new Event('resize'));

            }, 500);  // 0.5-sekundowe opóźnienie na załadowanie iframe
        });
    </script>
</body>
</html>